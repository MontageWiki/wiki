{# 1. 配置区域：在此定义弹出框内的快速链接 #}
{% set quick_links = [
    {"title": "百科语法指南", "url": "https://github.com/MontageWiki/wiki/wiki/Syntax-Guide"},
    {"title": "贡献指南", "url": "https://github.com/MontageWiki/wiki/wiki/Contribution-Guide"},
    {"title": "冲突处理说明", "url": "https://github.com/MontageWiki/wiki/wiki/Conflict-Resolution"}
] %}

{# 2. 逻辑处理：提取 GitHub Wiki 所需的页面名称 #}
{# 去掉文件后缀 .md 并处理索引页 index.md -> Home 的逻辑（如果需要） #}
{% set page_name = page.file.src_uri | replace(".md", "") %}
{% if page_name == "index" %}{% set page_name = "Home" %}{% endif %}

{% set base_wiki_url = "https://github.com/MontageWiki/wiki/wiki/" ~ page_name %}

<div class="md-content__actions" data-search-ignore aria-hidden="true">
  <style>
    /* 容器定位 */
    .custom-actions {
      display: flex;
      gap: 4px;
      position: relative;
      align-items: center;
    }

    /* 隐藏 details 默认箭头 */
    .custom-actions details summary {
      list-style: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      padding: 4px;
      border-radius: 100%;
      transition: background-color 0.25s;
      color: var(--md-default-fg-color--light);
    }

    .custom-actions details summary::-webkit-details-marker {
      display: none;
    }

    .custom-actions details summary:hover {
      background-color: var(--md-accent-fg-color--transparent);
      color: var(--md-accent-fg-color);
    }

    /* Popover 弹出框样式 */
    .custom-actions__popover {
      position: absolute;
      top: 100%;
      right: 0;
      z-index: 10;
      width: 200px;
      margin-top: 8px;
      background-color: var(--md-default-bg-color);
      box-shadow: var(--md-shadow-z2);
      border-radius: 4px;
      border: 1px solid var(--md-default-fg-color--lightest);
      overflow: hidden;
      contain: layout; /* 性能优化 */
      animation: popover-in 0.2s ease-out;
    }

    @keyframes popover-in {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* 弹出框内的链接项 */
    .custom-actions__link {
      display: block;
      padding: 12px 16px;
      font-size: 0.7rem;
      color: var(--md-default-fg-color);
      border-bottom: 1px solid var(--md-default-fg-color--lightest);
      text-decoration: none;
      transition: background-color 0.2s;
    }

    .custom-actions__link:last-child {
      border-bottom: none;
    }

    .custom-actions__link:hover {
      background-color: var(--md-default-fg-color--lightest);
      color: var(--md-accent-fg-color);
    }

    /* 图标尺寸控制 */
    .custom-actions svg {
      width: 1.2rem;
      height: 1.2rem;
      fill: currentColor;
    }

    /* 历史记录按钮样式 */
    .history-btn {
      padding: 4px;
      border-radius: 100%;
      color: var(--md-default-fg-color--light);
      transition: background-color 0.25s;
    }
    .history-btn:hover {
      background-color: var(--md-accent-fg-color--transparent);
      color: var(--md-accent-fg-color);
    }
  </style>

  <nav class="custom-actions">
    <details>
      <summary title="编辑本页">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/>
        </svg>
      </summary>
      <div class="custom-actions__popover">
        <a href="{{ base_wiki_url }}/_edit" class="custom-actions__link" style="font-weight: bold;">
          直接编辑此页面
        </a>
        {% for item in quick_links %}
          <a href="{{ item.url }}" class="custom-actions__link" target="_blank" rel="noopener">
            {{ item.title }}
          </a>
        {% endfor %}
      </div>
    </details>

    <a href="{{ base_wiki_url }}/_history" class="history-btn" title="查看历史记录">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M13.5 8H12v5l4.28 2.54.72-1.21-3.5-2.08V8M13 3a9 9 0 0 0-9 9H1l3.96 4.03L9 12H6a7 7 0 0 1 7-7 7 7 0 0 1 7 7 7 7 0 0 1-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.954 8.954 0 0 0 13 21a9 9 0 0 0 9-9 9 9 0 0 0-9-9Z"/>
      </svg>
    </a>
  </nav>
</div>
