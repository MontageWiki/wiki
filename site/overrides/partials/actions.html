
{# 1. 配置逻辑 #}
{% set repo_base = "https://github.com/MontageWiki/wiki/wiki" %}
{% set page_name = page.file.src_uri | replace("index.md", "Home") | replace(".md", "") %}

<div class="custom-actions-wrapper" data-search-ignore>
  
  {# 编辑按钮组 #}
  <details class="action-dropdown">
    <summary class="action-icon-trigger" title="贡献与编辑">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg>
    </summary>

    {# 弹出层：使用 aside 严格隔离正文 SEO #}
    <aside class="actions-popover-box" aria-hidden="true">
      <div class="popover-tip"></div> {# 水滴结构 #}
      <div class="popover-content">
        <div class="popover-intro">
          <strong>参与百科贡献</strong>
          <span>一本众创、共建、同享的字幕百科</span>
        </div>
        
        <a href="{{ repo_base }}/{{ page_name }}/_edit" class="gh-btn-edit">
          使用 GitHub 账号编辑
        </a>

        <nav class="popover-nav-links">
          <a href="{{ repo_base }}/百科语法指南">百科语法指南</a>
          <a href="{{ repo_base }}/GitHub-帮助指南">GitHub 帮助指南</a>
          <a href="{{ repo_base }}/贡献指南">贡献指南</a>
        </nav>
      </div>
    </aside>
  </details>

  {# 查看历史按钮 #}
  <a href="{{ repo_base }}/{{ page_name }}/_history" class="action-icon-trigger" title="查看编辑历史">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"></path></svg>
  </a>
</div>

<style>
/* 1. 彻底移除包裹感 [针对问题一] */
.custom-actions-wrapper {
  float: right;
  display: flex;
  gap: 16px;
  position: relative;
  z-index: 100;
}

.action-icon-trigger {
  display: inline-block;
  width: 24px;
  height: 24px;
  color: var(--md-icon-fg-color);
  cursor: pointer;
  background: none !important; /* 强制移除原生背景 */
  border: none !important;       /* 强制移除原生边框 */
  padding: 0 !important;        /* 移除填充 */
  list-style: none;
  transition: color 0.2s;
}

.action-icon-trigger:hover {
  color: var(--md-typeset-a-color);
}

.action-dropdown summary::-webkit-details-marker { display: none; }

/* 2. 弹出层、暗区阴影与水滴 [针对问题二] */
.actions-popover-box {
  position: absolute;
  top: 36px;
  right: 18px;
  width: 240px;
  background: var(--md-default-bg-color);
  border-radius: 8px;
  /* 深度暗区阴影 */
  box-shadow: 0 10px 30px rgba(0,0,0,0.2), 0 0 0 1px var(--md-divider-color);
  animation: popShow 0.2s ease-out;
}

/* 水滴结构 (小尖角) */
.popover-tip {
  position: absolute;
  top: -6px;
  right: 12px;
  width: 12px;
  height: 12px;
  background: var(--md-default-bg-color);
  transform: rotate(45deg);
  border-left: 1px solid var(--md-divider-color);
  border-top: 1px solid var(--md-divider-color);
}

/* 3. SEO 隔离样式 [针对问题三] */
.popover-content {
  padding: 16px;
  /* 确保文字不会因为紧凑而显得拥挤 */
  line-height: 1.5;
}

.popover-intro strong { display: block; font-size: 0.8rem; }
.popover-intro span { 
  display: block; 
  font-size: 0.65rem; 
  color: var(--md-default-fg-color--light);
  margin-bottom: 12px;
}

.gh-btn-edit {
  display: block;
  background-color: #1f883d;
  color: white !important;
  text-align: center;
  padding: 8px;
  border-radius: 6px;
  font-weight: 600;
  font-size: 0.75rem;
  margin-bottom: 12px;
}

.popover-nav-links {
  border-top: 1px solid var(--md-divider-color);
  padding-top: 10px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.popover-nav-links a {
  font-size: 0.7rem;
  color: var(--md-typeset-a-color);
}

@keyframes popShow {
  from { opacity: 0; transform: translateY(-5px); }
  to { opacity: 1; transform: translateY(0); }
}

/* 点击外部关闭的透明遮罩 */
.action-dropdown[open] summary::before {
  content: "";
  position: fixed;
  top: 0; left: 0; width: 100vw; height: 100vh;
  z-index: -1;
}
</style>
